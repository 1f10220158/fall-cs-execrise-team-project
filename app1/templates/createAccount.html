{% load static %}
<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <title>BreakingCipher.jp/createAccount.html</title>
    <link rel="stylesheet" type="text/css" href="{% static 'css/createAccountAndLogin.css' %}">
</head>

<body>

    <div id="header">
        <nav>
            <ul>
                <li><a href="" id="pageTitle">BreakingCipher.jp</a></li>
                <li><a href="">暗号投稿記事一覧へ</a></li>
                <li><a href="">xxxxxxxxxx へ</a></li>
                <li><a href="" id="user">ログイン</a></li>
            </ul>
        </nav>
    </div>

    <div id="main">
        <h1>アカウント作成</h1>
        <div id="inputBox">
            <form id="pushUserData">
                {% csrf_token %}

                <!--ユーザーネーム入力欄-->
                <div class="inBox">
                    <label for="userid">ユーザーID<br>
                        <input id="userid" type="text" placeholder="User ID" required>
                    </label>
                </div>

                <!--パスワード入力欄-->
                <div class="inBox">
                    <label for="pssword">パスワード<br>
                        <input id="password" type="text" placeholder="Password" required>
                    </label>
                </div>

                <button type="submit" id="buttonForCreate">Create</button>
            </form>
        </div>
    </div>

    <script src="{% static 'index.js' %}" defer></script>
    <script>
        /* headerパーツ*/
        if ("{{ userid | safe }}") {
            const userID = "{{ userid | safe }}";
            const element = document.getElementById('user');
            element.textContent = userID;
        }

        /* cookie関連 */
        const pushFromData = document.getElementById('pushUserData');

        pushFromData.addEventListener("submit", (event) => {
            const userid = document.getElementById('userid').value;
            const password = document.getElementById('password').value;
            const userData = {
                "userid": userid,
                "password": password,
            };

            event.preventDefault();
            window.location.href = "{% url 'index' %}";

            /* cookie保存の詳細:
            
            path= 'cookieが有効になる文書のパス'
            max-age= cookieの有効期限(秒)
            samesite= lax または strict (xsrf攻撃対策) 
            
            */

            const path = '/';
            const maxAge = '60*60*24*30';
            const samesite = 'lax';
            document.cookie = "userid=" + userid +
                "; path=" + path +
                "; max-age=" + maxAge +
                "; samesite=" + samesite;

            document.cookie = "password=" + password +
                "; path=" + path +
                "; max-age=" + maxAge +
                "; samesite=" + samesite;

            fetch("{% url 'storeCookie' %}", {
                method: "POST",
                header: {
                    "Content-type": "application/json"
                },
                body: JSON.stringify(userData)

            })
        })
    </script>
</body>

</html>